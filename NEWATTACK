local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local player = game:GetService("Players").LocalPlayer
local net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")

local registerAttack = net:FindFirstChild("RegisterAttack") or net:FindFirstChild("RE/RegisterAttack")
local registerHit = net:FindFirstChild("RegisterHit") or net:FindFirstChild("RE/RegisterHit")

-- CẤU HÌNH MAXIMUM
local HIT_PER_FRAME = 15 -- Số lần đánh trên mỗi NPC trong 1 khung hình (Tăng nếu muốn nhanh hơn)
local INFINITE_AOE = true -- Bật chế độ đánh toàn bản đồ

RunService.Heartbeat:Connect(function()
    local enemiesFolder = workspace:FindFirstChild("Enemies")
    if not enemiesFolder then return end

    -- Kích hoạt trạng thái tấn công một lần mỗi frame
    registerAttack:FireServer(1)

    for _, npc in ipairs(enemiesFolder:GetChildren()) do
        local hum = npc:FindFirstChildOfClass("Humanoid")
        local hitPart = npc:FindFirstChild("Head") or npc:FindFirstChild("HumanoidRootPart")

        -- Đánh nếu NPC còn sống, không cần check khoảng cách (AOE Vô hạn)
        if hum and hum.Health > 0 and hitPart then
            for i = 1, HIT_PER_FRAME do
                registerHit:FireServer(hitPart, {}, "default_code", 0.5)
            end
        end
    end
end)
