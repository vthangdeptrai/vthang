-- // Auto Attack Script (AOE Version, 120 hits/s)
-- ƒê√°nh t·∫•t c·∫£ NPC trong b√°n k√≠nh 30, spam 120 l·∫ßn m·ªói gi√¢y

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")

local player = Players.LocalPlayer

-- RemoteEvents (n·∫±m trong Modules/Net)
local net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")

local registerAttack = net:FindFirstChild("RegisterAttack") or net:FindFirstChild("RE/RegisterAttack")
local registerHit = net:FindFirstChild("RegisterHit") or net:FindFirstChild("RE/RegisterHit")

-- Debug n·∫øu kh√¥ng t√¨m th·∫•y
if not registerAttack or not registerHit then
    warn("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y RegisterAttack ho·∫∑c RegisterHit trong Net!")
    for _, obj in ipairs(net:GetChildren()) do
        print("üëâ Trong Net c√≥:", obj.Name, obj.ClassName)
    end
    return
end

-- H√†m l·∫•y t·∫•t c·∫£ NPC trong b√°n k√≠nh
local function GetEnemiesInRange(maxDistance)
    local enemiesFolder = Workspace:FindFirstChild("Enemies")
    if not enemiesFolder then return {} end

    local char = player.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return {} end

    local result = {}
    for _, npc in pairs(enemiesFolder:GetChildren()) do
        local humanoid = npc:FindFirstChildOfClass("Humanoid")
        local hitPart = npc:FindFirstChild("Head")
        if humanoid and humanoid.Health > 0 and hitPart then
            local d = (hitPart.Position - root.Position).Magnitude
            if d <= maxDistance then
                table.insert(result, npc)
            end
        end
    end
    return result
end

-- Auto Attack t·∫•t c·∫£ NPC trong b√°n k√≠nh (120 l·∫ßn/s)
local attackRange = 30
local delay = 1 / 120 -- 120 l·∫ßn / gi√¢y

task.spawn(function()
    while task.wait(delay) do
        local enemies = GetEnemiesInRange(attackRange)
        if #enemies > 0 then
            for _, npc in ipairs(enemies) do
                local hitPart = npc:FindFirstChild("Head")
                if hitPart then
                    -- Spam t·∫•n c√¥ng 120 l·∫ßn/s
                    registerAttack:FireServer(1)
                    registerHit:FireServer(hitPart, {}, "default_code", 0.5)
                end
            end
        end
    end
end)
